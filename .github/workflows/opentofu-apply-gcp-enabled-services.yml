name: "OpenTofu Apply GCP Enabled Services"

on:
  workflow_dispatch:
    inputs:
      OPENTOFU_VAR_FILE:
        description: "Opentofu variables file"
        required: false
        type: string
        default: "staging.tfvars"

permissions:
  contents: read
  id-token: write

jobs:
  tofu_apply:
    uses: AlexHag/k8/.github/workflows/reusable-opentofu-apply.yml@master
    with:
      GCP_WORKLOAD_IDENTITY_PROVIDER: "projects/615822691944/locations/global/workloadIdentityPools/github/providers/github"
      GCP_SERVICE_ACCOUNT: "github-actions-tofu@alexk8s-test-proj.iam.gserviceaccount.com"
      OPENTOFU_PATH: "opentofu/gcp-enabled-services"
      OPENTOFU_VAR_FILE: ${{ inputs.OPENTOFU_VAR_FILE }}